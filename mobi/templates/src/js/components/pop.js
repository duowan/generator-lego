/*! Project: LegoMobile
 *  Version: 3.0.0
 */
define("pop",["zepto"],function(a,b,c){var d=a("zepto"),e=function(a){var b={title:null,ref:null,refTop:0,pos:"",isClose:!0,scrollMove:!1,con:"",btns:[{text:"关闭",handler:"close"}],onShow:function(){},onClose:function(){}};this.opts=d.extend(b,a),this.init()};e.prototype.init=function(){var a=this,b=this.opts;a.id=b.id||"pop-"+f(),a.body=d("body"),a.bodyH=a.body.get(0).scrollHeight,a.win=d(window),a.winH=a.win.height(),a.winS=a.body.get(0).scrollTop,a.render()},e.prototype.position=function(){var a=this,b=a.opts,c=a.winH,e=a.winS,f=a.popH,h=a.bodyH,i=0,j=0;if("center"===b.pos)j=f>c?e+40:e+(c-f)/2;else{("string"==typeof b.ref||b.ref instanceof String)&&(b.ref=d(b.ref));var k=b.ref.offset();j=k.top+k.height+b.refTop;var l=j+f;l>h&&(j=h-f-40)}if(a.pop.css({top:j}),f>c)i=j-40-e,g(i,e);else if(e>j)i=j-40-e,g(i,e);else if(f+j-c-e>0){var m=j+f/2-c/2-e;g(m,e)}},e.prototype.renderBtn=function(a,b){var c="",d=a.length>2?2:a.length,e=function(){b.remove()};if(d>0){for(var f=0,g=d;g>f;f++){var h=a[f];if("object"==typeof h&&"undefined"!=typeof h.text){var i="";i="undefined"!=typeof h.href?'<span data-i="'+f+'"><a href="'+h.href+'">'+h.text+"</a></span>":'<span data-i="'+f+'">'+h.text+"</span>",c+=i,a[f].handler="undefined"!=typeof a[f].handler&&"close"===a[f].handler?e:a[f].handler}}return'<div class="pop-ft">'+c+"</div>"}return""},e.prototype.render=function(){var a=this,b=a.opts,c=b.title?'<div class="pop-hd">'+b.ti+"</div>":"",e=b.isClose?'<span class="pop-close"><i class="i-cross3"></i></span>':"",f=a.renderBtn(b.btns,a),g="";"undefined"!=typeof b.msg?g='<div class="pop-msg">'+b.msg+"</div>":"undefined"!=typeof b.con&&(g=d.isFunction(b.con)?b.con(a):b.con);var h='<div id="'+a.id+'" class="pop-mod" style="visibility:hidden;">'+c+'<div class="pop-bd">'+g+"</div>"+f+e+"</div>",i=d("#pop-dialogs"),j=d("#pop-overlay");0===i.size()&&0===j.size()?(a.body.append('<div id="pop-dialogs">'+h+'</div><div id="pop-overlay" style="height:'+a.bodyH+'px;display:none;"></div>'),j=d("#pop-overlay")):i.html(h);var k=a.pop=d("#"+a.id);a.popOver=j,a.popH=k.offset().height,b.pos=null===b.ref?"center":b.pos,a.position(),j.show(),k.css("visibility","visible"),setTimeout(function(){a.bind()},400)},e.prototype.bind=function(){var a=this,b=a.opts;b.onShow(a.pop,a);var c=b.btns;a.pop.on("click",".pop-ft span",function(){var b=d(this).attr("data-i");d.isFunction(c[b].handler)&&c[b].handler(a.pop,a)}),b.isClose&&a.pop.on("click",".pop-close",d.proxy(this.remove,a)),a.pop.on("click","a",d.proxy(this.remove,a)),a.win.bind("orientationchange",function(){a.body.css("height","auto"),a.bodyH=a.body.get(0).scrollHeight,a.popOver.height(a.bodyH),a.winH=a.win.height(),a.winS=a.body.get(0).scrollTop,a.position()}),d(window).on("touchmove",function(a){b.scrollMove&&a.preventDefault()})},e.prototype.reset=function(){var a=this;a.popH=a.pop.offset().height,a.position()},e.prototype.remove=function(){var a=this;d.isFunction(a.opts.onClose)&&a.opts.onClose(a.pop,a),a.pop.remove(),a.popOver.hide().height(a.bodyH),a.win.unbind("orientationchange"),a=null};var f=function(){var a=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)};return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()},g=function(a,b){function c(){f>e&&(e++,h.scrollTop=Math.ceil(i(e,0,g,f))+b,setTimeout(c,20))}var e=0,f=30,g=a,h=d("body").get(0),i=function(a,b,c,d){return a==d?b+c:c*(-Math.pow(2,-10*a/d)+1)+b};c()};d.fn.pop=function(a){return a=d.extend(a,{ref:this[0]}),new e(a)},c.exports=function(a){return new e(a)}});