/*! Project: LegoMobile
 *  Version: 3.0.0
 */
define("refresh",["zepto","iscroll-probe"],function(a,b,c){var d=a("zepto"),e=a("iscroll-probe"),f=function(a){var b={afterRefresh:null,threshold:30};this.options=d.extend(b,a),this.$el=arguments[0].el,this.init()};f.prototype.init=function(){var a=this,b=a.options;d.each(["up","down"],function(c,e){a.status(e,!0),b.refreshInfo||(b.refreshInfo={}),b.refreshInfo[e]={$icon:d(".m-refresh-"+e).find(".m-refresh-icon"),$label:d(".m-refresh-"+e).find(".m-refresh-label"),text:d(".m-refresh-"+e).find(".m-refresh-label").html()}}),a.initIScroll()},f.prototype.initIScroll=function(){var a=this,b=a.options,c=a.$el;b.iScroll=new e(c,{probeType:3,mouseWheel:!0}),b.iScroll.on("scrollStart",function(){}),b.iScroll.on("scroll",function(){var c=a.status("up"),d=a.status("down"),e=b.upRefreshed,f=b.downRefreshed;c&&!e&&this.y>b.threshold?a.setMoveState("up","beforeload"):c&&e&&this.y<b.threshold?a.setMoveState("up","loaded"):d&&!f&&this.y<this.maxScrollY-b.threshold?a.setMoveState("down","beforeload"):d&&f&&this.y>this.maxScrollY+b.threshold&&a.setMoveState("down","loaded")}),b.iScroll.on("scrollEnd",function(){var c=b.direction;c&&a.status(c)&&(a.setStyle(c,"loading"),a.loadingAction(c))})},f.prototype.status=function(a,b){var c=this.options;return void 0===b?c[a+"Open"]:c[a+"Open"]=!!b},f.prototype.setStyle=function(a,b){var c=this,d=c.options;switch(refreshInfo=d.refreshInfo[a],b){case"loaded":refreshInfo.$label.html(refreshInfo.text),refreshInfo.$icon.removeClass().addClass("m-refresh-icon");break;case"loading":refreshInfo.$label.html("加载中..."),refreshInfo.$icon.addClass("m-loading");break;case"disable":refreshInfo.$label.html("没有更多内容了");break;case"beforeload":refreshInfo.$label.html("松开立即加载"),refreshInfo.$icon.addClass("m-refresh-flip")}},f.prototype.setMoveState=function(a,b){var c=this,d=c.options;c.setStyle(a,b),d.direction=a},f.prototype.loadingAction=function(a,b){var c=this,e=c.options,f=e.afterRefresh;return d.isFunction(f)&&f.call(c,a,b),c.status(a,!1),c},f.prototype.afterRefreshLoading=function(a){var b=this,c=b.options,d=d||c.direction;return c.iScroll.refresh(),c[a+"Refreshed"],b.setStyle(a,"loaded"),b.status(a,!0),b},d.fn.Refresh=function(a){return a=d.extend(a,{el:this[0]}),new f(a)},c.exports=function(a){return new f(a)}});